name: Multi-Platform Pull and Save Docker Image

on:
  workflow_dispatch:
    inputs:
      docker_images:
        description: '请填写docker镜像名称 多个用英文逗号分开'
        required: true
        default: 'alpine:latest,busybox:stable-glibc'  # 设置默认的 Docker 镜像列表

jobs:
  inspect_platforms:
    runs-on: ubuntu-22.04
    steps:
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Inspect image manifest
        run: |
          images="${{ github.event.inputs.docker_images }}"
          docker buildx imagetools inspect $images --raw | \
          jq -r '
            if .manifests then
              .manifests[].platform | 
              "\(.os)/\(.architecture)\(if .variant then "/"+.variant else "" end)"
            else
              "\(.os)/\(.architecture)\(if .variant then "/"+.variant else "" end)"
            end' | \
          sort | uniq > platforms.txt
          echo "SUPPORTED_PLATFORMS=$(paste -sd, platforms.txt)" >> $GITHUB_ENV

      - name: Print results
        run: |
          if [ -s platforms.txt ]; then
            echo "✅ 多平台镜像支持:"
            cat platforms.txt
          else
            echo "❌ 非多平台镜像"
          fi
        env:
          image: your-image:tag  # 替换为目标镜像名
